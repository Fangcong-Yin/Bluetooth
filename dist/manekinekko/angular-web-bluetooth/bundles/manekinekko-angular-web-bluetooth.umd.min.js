!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@manekinekko/angular-web-bluetooth",["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).manekinekko=e.manekinekko||{},e.manekinekko["angular-web-bluetooth"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common)}(this,(function(e,t,r,n,o){"use strict";var i=function(){function e(){if(this.ble=navigator.bluetooth,!this.ble)throw new Error("Your browser does not support Smart Bluetooth. See http://caniuse.com/#search=Bluetooth for more details.")}return e.prototype.requestDevice=function(e){return this.ble.requestDevice(e)},e}();i.decorators=[{type:t.Injectable}],i.ctorParameters=function(){return[]};var c=function(){function e(){}return e.instance=function(){return{}},e}();c.decorators=[{type:t.Injectable}];function a(e,t,r,n){return new(r||(r=Promise))((function(o,i){function c(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,a)}s((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}Object.create;function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)c.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return c}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}Object.create;var l=function(){function e(){}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,e)},e}();l.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new l},token:l,providedIn:"root"}),l.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}];var h=function(){function e(){}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e}();h.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new h},token:h,providedIn:"root"}),h.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}];var v=function(){function e(e,r){this.webBle=e,this.console=r,this.device$=new t.EventEmitter,this.gatt$=new t.EventEmitter,this.characteristicValueChanges$=new t.EventEmitter,this.gattServer=null}return e.prototype.getDevice$=function(){return this.device$},e.prototype.getGATT$=function(){return this.gatt$},e.prototype.streamValues$=function(){return this.characteristicValueChanges$.pipe(n.filter((function(e){return e&&e.byteLength>0})))},e.prototype.value=function(e){return a(this,void 0,void 0,(function(){var t,r,n,o,i,c;return s(this,(function(a){switch(a.label){case 0:this.console.log("[BLE::Info] Reading value with options %o",e),void 0===e.acceptAllDevices&&(e.acceptAllDevices=!0),void 0===e.optionalServices?e.optionalServices=[e.service]:e.optionalServices=f(e.optionalServices),this.console.log("[BLE::Info] Reading value with options %o",e),a.label=1;case 1:return a.trys.push([1,7,,8]),[4,this.discover({acceptAllDevices:e.acceptAllDevices,optionalServices:e.optionalServices})];case 2:return t=a.sent(),this.console.log("[BLE::Info] Device info %o",t),[4,this.connectDevice(t)];case 3:return r=a.sent(),this.console.log("[BLE::Info] GATT info %o",r),[4,this.getPrimaryService(r,e.service)];case 4:return n=a.sent(),this.console.log("[BLE::Info] Primary Service info %o",n),[4,this.getCharacteristic(n,e.characteristic)];case 5:return o=a.sent(),this.console.log("[BLE::Info] Characteristic info %o",o),[4,o.readValue()];case 6:return i=a.sent(),this.console.log("[BLE::Info] Value info %o",i),[2,i];case 7:throw c=a.sent(),new Error(c);case 8:return[2]}}))}))},e.prototype.value$=function(e){return r.from(this.value(e))},e.prototype.discover=function(e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:e.optionalServices=e.optionalServices||["generic_access"],this.console.log("[BLE::Info] Requesting devices with options %o",e),t=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.webBle.requestDevice(e)];case 2:return(t=n.sent()).addEventListener("gattserverdisconnected",this.onDeviceDisconnected.bind(this)),t?this.device$.emit(t):this.device$.error("[BLE::Error] Can not get the Bluetooth Remote GATT Server. Abort."),[3,4];case 3:return r=n.sent(),this.console.error(r),[3,4];case 4:return[2,t]}}))}))},e.prototype.onDeviceDisconnected=function(e){var t=e.target;this.console.log("[BLE::Info] disconnected device %o",t),this.device$.emit(null)},e.prototype.discover$=function(e){var t=this;return r.from(this.discover(e)).pipe(n.mergeMap((function(e){return t.connectDevice$(e)})))},e.prototype.connectDevice=function(e){return a(this,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:if(!e)return[3,5];this.console.log("[BLE::Info] Connecting to Bluetooth Remote GATT Server of %o",e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.gatt.connect()];case 2:return t=n.sent(),this.gattServer=t,this.gatt$.emit(t),[2,t];case 3:return r=n.sent(),Promise.reject(""+r.message),this.gatt$.error(""+r.message),[3,4];case 4:return[3,6];case 5:this.console.error("[BLE::Error] Was not able to connect to Bluetooth Remote GATT Server"),this.gatt$.error(null),n.label=6;case 6:return[2]}}))}))},e.prototype.connectDevice$=function(e){return r.from(this.connectDevice(e))},e.prototype.disconnectDevice=function(){this.gattServer&&(this.console.log("[BLE::Info] Disconnecting from Bluetooth Device %o",this.gattServer),this.gattServer.connected?this.gattServer.disconnect():this.console.log("[BLE::Info] Bluetooth device is already disconnected"))},e.prototype.getPrimaryService=function(e,t){return a(this,void 0,void 0,(function(){var r,n;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,5]),[4,e.getPrimaryService(t)];case 1:return r=o.sent(),[4,Promise.resolve(r)];case 2:return[2,o.sent()];case 3:return n=o.sent(),[4,Promise.reject(n.message+" ("+t+")")];case 4:return[2,o.sent()];case 5:return[2]}}))}))},e.prototype.getPrimaryService$=function(e,t){return this.console.log('[BLE::Info] Getting primary service "%s" (if available) of %o',t,e),e?r.from(this.getPrimaryService(e,t)):r.throwError(new Error("[BLE::Error] Was not able to connect to the Bluetooth Remote GATT Server"))},e.prototype.getCharacteristic=function(e,t){return a(this,void 0,void 0,(function(){var r,n,o=this;return s(this,(function(i){switch(i.label){case 0:this.console.log('[BLE::Info] Getting Characteristic "%s" of %o',t,e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.getCharacteristic(t)];case 2:return(r=i.sent()).properties.notify?r.startNotifications().then((function(e){o.console.log('[BLE::Info] Starting notifications of "%s"',t),r.addEventListener("characteristicvaluechanged",o.onCharacteristicChanged.bind(o))}),(function(e){Promise.reject(e.message+" ("+t+")")})):r.addEventListener("characteristicvaluechanged",this.onCharacteristicChanged.bind(this)),[2,r];case 3:return n=i.sent(),Promise.reject(n.message+" ("+t+")"),[3,4];case 4:return[2]}}))}))},e.prototype.getCharacteristic$=function(e,t){return this.console.log('[BLE::Info] Getting Characteristic "%s" of %o',t,e),r.from(this.getCharacteristic(e,t))},e.prototype.setCharacteristicState=function(e,t,r){var o=this,i=this.getPrimaryService$(this.gattServer,e);return i.pipe(n.mergeMap((function(e){return o.getCharacteristic$(e,t)}))).subscribe((function(e){return o.writeValue$(e,r)})),i},e.prototype.enableCharacteristic=function(e,t,r){return r=r||new Uint8Array([1]),this.setCharacteristicState(e,t,r)},e.prototype.disbaleCharacteristic=function(e,t,r){return r=r||new Uint8Array([0]),this.setCharacteristicState(e,t,r)},e.prototype.onCharacteristicChanged=function(e){this.console.log("[BLE::Info] Dispatching new characteristic value %o",e);var t=e.target.value;this.characteristicValueChanges$.emit(t)},e.prototype.readValue$=function(e){return this.console.log("[BLE::Info] Reading Characteristic %o",e),r.from(e.readValue().then((function(e){return Promise.resolve(e)}),(function(e){return Promise.reject(""+e.message)})))},e.prototype.writeValue$=function(e,t){return this.console.log("[BLE::Info] Writing Characteristic %o",e),r.from(e.writeValue(t).then((function(e){return Promise.resolve()}),(function(e){return Promise.reject(""+e.message)})))},e.prototype.observeValue$=function(e){e.startNotifications();var t=r.fromEvent(e.service.device,"gattserverdisconnected");return r.fromEvent(e,"characteristicvaluechanged").pipe(n.map((function(e){return e.target.value})),n.takeUntil(t))},e.prototype.littleEndianToUint16=function(e,t){return(this.littleEndianToUint8(e,t+1)<<8)+this.littleEndianToUint8(e,t)},e.prototype.littleEndianToUint8=function(e,t){return e.getUint8(t)},e.prototype.fakeNext=function(e){void 0===e&&(e=function(){var e=new DataView(new ArrayBuffer(8));return e.setUint8(0,110*Math.random()|0),e}),this.characteristicValueChanges$.emit(e())},e}();function p(){return new i}function d(e){return e&&e.enableTracing?new l:new h}function g(){return new t.InjectionToken("AWBOptions")}v.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new v(t.ɵɵinject(i),t.ɵɵinject(l))},token:v,providedIn:"root"}),v.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],v.ctorParameters=function(){return[{type:i},{type:l}]};var E=function(){function e(){}return e.forRoot=function(t){return void 0===t&&(t={}),{ngModule:e,providers:[v,{provide:i,useFactory:p},{provide:g,useValue:t},{provide:l,useFactory:d,deps:[g]}]}},e}();E.decorators=[{type:t.NgModule,args:[{imports:[o.CommonModule]}]}];var b={DEVICE_INFORMATION:{SERVICE:"f000180a-0451-4000-b000-000000000000",SYSTEM_ID:"f0002a23-0451-4000-b000-000000000000",MODEL_NUMBER:"f0002a24-0451-4000-b000-000000000000",SERIAL_NUMBER:"f0002a25-0451-4000-b000-000000000000",FIRMWARE_REV:"f0002a26-0451-4000-b000-000000000000",HARDWARE_REV:"f0002a27-0451-4000-b000-000000000000",SOFTWARE_REV:"f0002a28-0451-4000-b000-000000000000",MANIFACTURER:"f0002a29-0451-4000-b000-000000000000",IEEE11073:"f0002a2a-0451-4000-b000-000000000000",PNP_ID:"f0002a50-0451-4000-b000-000000000000"},BATTERY:{SERVICE:"f000180f-0451-4000-b000-000000000000",LEVEL:"f0002a19-0451-4000-b000-000000000000"},TEMPERATURE:{SERVICE:"f000aa00-0451-4000-b000-000000000000",DATA:"f000aa01-0451-4000-b000-000000000000",CONFIGURATION:"f000aa02-0451-4000-b000-000000000000",PERIOD:"f000aa03-0451-4000-b000-000000000000"},HUMIDITY:{SERVICE:"f000aa20-0451-4000-b000-000000000000",DATA:"f000aa21-0451-4000-b000-000000000000",CONFIGURATION:"f000aa22-0451-4000-b000-000000000000",PERIOD:"f000aa23-0451-4000-b000-000000000000"},BAROMETER:{SERVICE:"f000aa40-0451-4000-b000-000000000000",DATA:"f000aa41-0451-4000-b000-000000000000",CONFIGURATION:"f000aa42-0451-4000-b000-000000000000",PERIOD:"f000aa44-0451-4000-b000-000000000000"},MOVEMENT:{SERVICE:"f000aa80-0451-4000-b000-000000000000",DATA:"f000aa81-0451-4000-b000-000000000000",CONFIGURATION:"f000aa82-0451-4000-b000-000000000000",PERIOD:"f000aa83-0451-4000-b000-000000000000"},LIGHT:{SERVICE:"f000aa70-0451-4000-b000-000000000000",DATA:"f000aa71-0451-4000-b000-000000000000",CONFIGURATION:"f000aa72-0451-4000-b000-000000000000",PERIOD:"f000aa73-0451-4000-b000-000000000000"},KEYPRESS:{SERVICE:"f000ffe0-0451-4000-b000-000000000000",STATE:"f000ffe1-0451-4000-b000-000000000000"},__REGISTER__:{SERVICE:"f000ac00-0451-4000-b000-000000000000",DATA:"f000ac01-0451-4000-b000-000000000000",ADDRESS:"f000ac02-0451-4000-b000-000000000000",DEVICE_ID:"f000ac03-0451-4000-b000-000000000000"},CONTROL:{SERVICE:"f000ccc0-0451-4000-b000-000000000000",CURRENT_USED_PARAMETERS:"f000ccc1-0451-4000-b000-000000000000",REQUEST_NEW_PARAMETERS:"f000ccc2-0451-4000-b000-000000000000",DISCONNECT_REQUEST:"f000ccc3-0451-4000-b000-000000000000"},OAD:{SERVICE:"f000ffc0-0451-4000-b000-000000000000",IMAGE_NOTIFY:"f000ffc1-0451-4000-b000-000000000000",IMAGE_BLOCK_REQUEST:"f000ffc2-0451-4000-b000-000000000000",IMAGE_COUNT:"f000ffc3-0451-4000-b000-000000000000",IMAGE_STATUS:"f000ffc4-0451-4000-b000-000000000000"},IO:{SERVICE:"f000aa64-0451-4000-b000-000000000000",DATA:"f000aa65-0451-4000-b000-000000000000",CONFIG:"f000aa66-0451-4000-b000-000000000000"}},y=function(e){return b[e].SERVICE},m=Object.keys(b).map(y),I=function(){function e(e,t){this.id=e,this.name=t,this.listeners={gattserverdisconnected:[]}}return e.prototype.addEventListener=function(e,t){this.listeners[e]=f(this.listeners[e],[t])},e.prototype.disconnect=function(){var e={target:this};this.listeners.gattserverdisconnected.forEach((function(t){return t(e)}))},e.prototype.clear=function(){this.id=void 0,this.name=void 0,this.listeners={gattserverdisconnected:[]}},e}(),S=function(){function e(e,t){this.device=e,this.services=t,this.connected=!1,e.gatt=this}return e.prototype.connect=function(){return this.connected=!0,Promise.resolve(this)},e.prototype.getPrimaryService=function(e){return Promise.resolve(this.services[e].service)},e.prototype.disconnect=function(){this.device.disconnect(),this.connected=!1},e}(),R=function(){function e(e,t){this.device=e,this.characteristics=t,this.characteristics.service=this}return e.prototype.getCharacteristic=function(e){return Promise.resolve(this.characteristics[e])},e}(),T=function(){function e(e,t){this.listeners={characteristicvaluechanged:[]},this.properties=e,this.value=t,this.initialValue=t}return e.prototype.readValue=function(){return Promise.resolve(this.value)},e.prototype.addEventListener=function(e,t){this.listeners[e]=f(this.listeners[e],[t])},e.prototype.changeValue=function(e){this.value=e;var t={target:this};this.listeners.characteristicvaluechanged.forEach((function(e){return e(t)}))},e.prototype.clear=function(){this.value=this.initialValue,this.listeners={characteristicvaluechanged:[]}},e}();e.BluetoothCore=v,e.BrowserWebBluetooth=i,e.ConsoleLoggerService=l,e.FakeBluetoothDevice=I,e.FakeBluetoothRemoteGATTCharacteristic=T,e.FakeBluetoothRemoteGATTServer=S,e.FakeBluetoothRemoteGATTService=R,e.NoLoggerService=h,e.ServerWebBluetooth=c,e.TI_SENSORAG_SERVICES=m,e.TiTag=b,e.WebBluetoothModule=E,e.browserWebBluetooth=p,e.consoleLoggerServiceConfig=d,e.makeMeTokenInjector=g,e.ɵ0=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=manekinekko-angular-web-bluetooth.umd.min.js.map